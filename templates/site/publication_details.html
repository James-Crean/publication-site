
{% if message %}
<div class="alert alert-warning">{{ message }}</div>
{% endif %}
<form action="/new" method="post">
    {% csrf_token %}
    <div id="pub_form">
        {{ pub_form }}
    </div>
    <div id="tabs" class="panel panel-default">
        <div class="panel-heading">
            <input id="pub_type" type="hidden" name="pub_type" value="Book">
            <ul class="nav nav-tabs">
                <li class="active" role="presentation"><a href="#tabs-1">Book</a></li>
                <li role="presentation"><a href="#tabs-2">Conference</a></li>
                <li role="presentation"><a href="#tabs-3">Journal</a></li>
                <li role="presentation"><a href="#tabs-4">Magazine</a></li>
                <li role="presentation"><a href="#tabs-5">Poster</a></li>
                <li role="presentation"><a href="#tabs-6">Presentation</a></li>
                <li role="presentation"><a href="#tabs-7">Technical_Report</a></li>
                <li role="presentation"><a href="#tabs-8">Other</a></li>
            </ul>
        </div>
        <div class="panel-body">
            <div id="tabs-1">
                {{ book_form }}
            </div>
            <div id="tabs-2">
                {{ conference_form }}
            </div>
            <div id="tabs-3">
                {{ journal_form }}
            </div>
            <div id="tabs-4">
                {{ magazine_form }}
            </div>
            <div id="tabs-5">
                {{ poster_form }}
            </div>
            <div id="tabs-6">
                {{ presentation_form }}
            </div>
            <div id="tabs-7">
                {{ technical_form }}
            </div>
            <div id="tabs-8">
                {{ other_form }}
            </div>
        </div>
    </div>

    {% include "snippets/authorForm.html" %}

    {% include "snippets/metaForm.html" %}
</form>

<div class="text-center">
    <button class="submit-form btn btn-primary" onclick="submitPublication()">Submit</button>
</div>

<script>
    $(function() {$( "#tabs" ).tabs();} );
    $('#tabs a').click(function( event ) {
    $('#tabs .active').removeClass('active');
    $(event.target).parent().addClass('active');
    $('#pub_type').val($(event.target).text());
    });

    var count = parseInt($('#id_form-TOTAL_FORMS').val());
    for(i=0; i < count; i++) {
        $('#id_form-' + i + '-DELETE').closest('td').remove();
    }
    $('#add_author').click(function( event ) {
        event.preventDefault();
        cloneMore('tr.author:last');
    });

    $('#author-form').on('click', '.author-delete', function( event ) {
        event.preventDefault();
        var total = $('#id_form-TOTAL_FORMS').val();
        if(total > 1) {
            var form = $(event.target).closest('.author');
            $('#id_form-TOTAL_FORMS').val(total-1);
            $(form).remove();
        }
        else {
            alert('Publications must have at least 1 author.');
        }
    });

</script>
