{% if message %}
<div class="alert alert-warning">{{ message }}</div>
{% endif %}
<form action="/new" method="post">
    {% csrf_token %}
    <div class="pub_form">
        {{ pub_form }}
    </div>
    <div id="tabs">
        <input id="pub_type" type="hidden" name="pub_type" value="Book">
        <ul class="nav nav-tabs">
            <li class="active" role="presentation"><a href="#tabs-1">Book</a></li>
            <li role="presentation"><a href="#tabs-2">Conference</a></li>
            <li role="presentation"><a href="#tabs-3">Journal</a></li>
            <li role="presentation"><a href="#tabs-4">Magazine</a></li>
            <li role="presentation"><a href="#tabs-5">Poster</a></li>
            <li role="presentation"><a href="#tabs-6">Presentation</a></li>
            <li role="presentation"><a href="#tabs-7">Technical_Report</a></li>
            <li role="presentation"><a href="#tabs-8">Other</a></li>
        </ul>
        <div id="tabs-1">
            {{ book_form }}
        </div>
        <div id="tabs-2">
            {{ conference_form }}
        </div>
        <div id="tabs-3">
            {{ journal_form }}
        </div>
        <div id="tabs-4">
            {{ magazine_form }}
        </div>
        <div id="tabs-5">
            {{ poster_form }}
        </div>
        <div id="tabs-6">
            {{ presentation_form }}
        </div>
        <div id="tabs-7">
            {{ technical_form }}
        </div>
        <div id="tabs-8">
            {{ other_form }}
        </div>
    </div>
    <div id="author-form">
        {% for form in author_form %}
        <div class="panel panel-default author">
            <div class="panel-heading">
                <span class="md-font">Author Details</span>
                <a class="btn btn-xs btn-danger pull-right author-delete" role="button" title="Delete">
                    <span class="glyphicon glyphicon-trash"></span>
                </a>
            </div>
            <div class="panel-body"> {{form}} </div>
        </div>
        {% endfor %}
    </div>
    {{author_form.management_form}}

    <button class="btn btn-info" id="add_author">Add Author</button>

    </div>
    <div id="meta-form">
        <span class="meta-form-list col-md-4 well">{{ exp_form }}</span>
        <span class="meta-form-list col-md-4 well">{{ freq_form }}</span>
        <span class="meta-form-list col-md-4 well">{{ model_form }}</span>
        <span class="meta-form-list col-md-4 well">{{ keyword_form }}</span>
        <span class="meta-form-list col-md-6 well">{{ var_form }}</span>
    </div>
</form>

<div class="text-center">
    <button class="submit-form btn btn-primary" onclick="submitPublication()">Submit</button>
</div>

<script>
    $(function() {$( "#tabs" ).tabs();} );
    $('#tabs a').click(function( event ) {
    $('#tabs .active').removeClass('active');
    $(event.target).parent().addClass('active');
    $('#pub_type').val($(event.target).text());
    });

    $('#add_author').click(function( event ) {
        event.preventDefault();
        cloneMore('div.author:last', 'form');
    });

    $('#author-form').on('click', '.author-delete', function( event ) {
        event.preventDefault();
        var total = $('#id_form-TOTAL_FORMS').val();
        if(total > 1) {
            var form = $(event.target).closest('.author');
            $('#id_form-TOTAL_FORMS').val(total-1);
            $(form).remove();
        }
        else {
            alert('Publications must have at least 1 author.');
        }
    });
</script>
